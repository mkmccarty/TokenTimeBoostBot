name: Auto-merge RenegadeEgg Complaints
on:
  pull_request_target:
    types: [opened, synchronize, reopened]
    paths:
      - 'data/token-complaints.json'

jobs:
  auto-merge:
    runs-on: ubuntu-latest
    # Check if the contributor is exactly 'renegadeEgg'
    if: github.actor == 'renegadeEgg'
    
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Verify only the specific file was changed
        id: check_files
        run: |
          # Get list of changed files
          CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }})
          echo "Files changed: $CHANGED_FILES"
          
          # If the output is exactly our target file, proceed
          if [ "$CHANGED_FILES" = "data/token-complaints.json" ]; then
            echo "MATCH=true" >> $GITHUB_OUTPUT
          else
            echo "Other files were modified. Blocking auto-merge."
            exit 1
          fi

      - name: Auto-merge PR
        if: steps.check_files.outputs.MATCH == 'true'
        uses: pascalgn/automerge-action@v0.16.4
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          MERGE_METHOD: "merge"
          MERGE_LABELS: "" # No specific labels required
